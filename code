#include <Servo.h>
#include <Wire.h>

// ==== KONSTANTA ====
const float SOUND_SPEED = 0.034;   // cm per micro-second

// ==== PIN ====
const int trig1 = 9;
const int echo1 = 8;

const int trig2 = 6;
const int echo2 = 7;

const int servoPin   = 10;
const int buzzerPin  = 11;

// ==== OBJEK ====
Servo servo1;

// ==== VARIABEL ====
float jarak1_cm = 0;
float jarak2_cm = 0;

// ==== FUNGSI BACA JARAK ====
float bacaJarakCM(int trigPin, int echoPin) {
  digitalWrite(trigPin, LOW);
  delayMicroseconds(2);
  digitalWrite(trigPin, HIGH);
  delayMicroseconds(10);
  digitalWrite(trigPin, LOW);

  long durasi_us = pulseIn(echoPin, HIGH, 30000); // timeout 30 ms
  if (durasi_us == 0) return 0;

  return (durasi_us * SOUND_SPEED) / 2.0;
}

// ==== SETUP ====
void setup() {
  Serial.begin(9600);

  pinMode(trig1, OUTPUT);
  pinMode(echo1, INPUT);
  pinMode(trig2, OUTPUT);
  pinMode(echo2, INPUT);
  pinMode(buzzerPin, OUTPUT);

  servo1.attach(servoPin);
  servo1.write(0); // posisi awal tertutup
}

// ==== LOOP ====
void loop() {
  jarak1_cm = bacaJarakCM(trig1, echo1);
  jarak2_cm = bacaJarakCM(trig2, echo2);

  Serial.print("Sensor1: ");
  Serial.print(jarak1_cm, 1);
  Serial.print(" cm | Sensor2: ");
  Serial.print(jarak2_cm, 1);
  Serial.println(" cm");

  // Buka tutup otomatis jika objek dekat
  if (jarak1_cm > 0 && jarak1_cm <= 5) {
    Serial.println("Tutup dibuka...");
    servo1.write(50); // buka tutup
    delay(5000);      // tunggu 3 detik
    servo1.write(180);  // tutup kembali
  }

  // Deteksi sampah penuh
  if (jarak2_cm > 0 && jarak2_cm <= 4) {
    Serial.println("Status: PENUH");
    buzzerBeep3();
  } else {
    Serial.println("Status: KOSONG");
    noTone(buzzerPin);
  }

  Serial.println("-----------------------");
  delay(1500); // delay antar pembacaan
}

// ==== BUNYI BUZZER 3Ã— ====
void buzzerBeep3() {
  for (byte i = 0; i < 3; i++) {
    tone(buzzerPin, 1000); // 1000 Hz
    delay(200);
    noTone(buzzerPin);
    delay(200);
  }
}
